{% extends "lotto/base.html" %}

{% block title %}관리자 대시보드{% endblock %}

{% block content %}
<h2 class="page-title">관리자 대시보드</h2>
<p class="page-subtitle">
    판매 실적, 회차 상태, 추첨 및 당첨 정보를 한눈에 확인합니다.
</p>

<div class="row g-4">
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header">총 판매액</div>
            <div class="card-body d-flex flex-column justify-content-center">
                <h3 class="mb-0">{{ total_sales|default:0 }}원</h3>
            </div>
        </div>
    </div>

    <div class="col-md-8">
        <div class="card shadow-sm h-100">
            <div class="card-header">현재 회차 관리</div>
            <div class="card-body">
                {% if current_round %}
                    <p>
                        <strong>{{ current_round.round_number }}회차</strong><br>
                        추첨일: {{ current_round.draw_date }}<br>
                        상태:
                        {% if current_round.is_drawn %}
                            <span class="badge bg-success">추첨 완료</span>
                        {% else %}
                            <span class="badge bg-warning text-dark">판매 / 추첨 대기</span>
                        {% endif %}
                    </p>

                    <div class="btn-group flex-wrap" role="group">
                        {% if not current_round.is_drawn %}
                            <a href="{% url 'admin_draw_round' current_round.round_number %}"
                               class="btn btn-sm btn-danger">
                                현재 회차 추첨 실행
                            </a>
                        {% endif %}

                        <a href="{% url 'admin_winners' current_round.round_number %}"
                           class="btn btn-sm btn-primary {% if not current_round.is_drawn %}disabled{% endif %}">
                            당첨자 / 등수 통계
                        </a>

                        {% if current_round.is_drawn %}
                            <a href="{% url 'admin_create_next_round' %}"
                               class="btn btn-sm btn-success">
                                다음 회차 생성
                            </a>
                        {% endif %}
                    </div>
                {% else %}
                    <p>아직 생성된 회차가 없습니다.</p>
                    <a href="{% url 'admin_create_next_round' %}" class="btn btn-sm btn-success">
                        1회차 생성
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<h3 class="mt-4">최근 회차 목록</h3>
<div class="card shadow-sm">
    <div class="card-body p-0">
        <table class="table mb-0 align-middle">
            <thead class="table-light">
                <tr>
                    <th>회차</th>
                    <th>추첨일</th>
                    <th>상태</th>
                    <th>판매액</th>
                    <th>관리</th>
                </tr>
            </thead>
            <tbody>
                {% for r in rounds %}
                    <tr>
                        <td>{{ r.round_number }}회</td>
                        <td>{{ r.draw_date }}</td>
                        <td>{% if r.is_drawn %}완료{% else %}미완료{% endif %}</td>
                        <td>{{ r.total_sales_amount }}원</td>
                        <td>
                            {% if not r.is_drawn %}
                                <a href="{% url 'admin_draw_round' r.round_number %}"
                                   class="btn btn-sm btn-danger">
                                    추첨 실행
                                </a>
                            {% else %}
                                <a href="{% url 'round_result' r.round_number %}"
                                   class="btn btn-sm btn-primary">
                                    결과 보기
                                </a>
                                <a href="{% url 'admin_winners' r.round_number %}"
                                   class="btn btn-sm btn-outline-secondary">
                                    당첨자 통계
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr><td colspan="5" class="text-center">등록된 회차가 없습니다.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
